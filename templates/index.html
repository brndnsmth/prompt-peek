<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Peek</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="bg-white shadow-lg rounded-lg w-3/4 h-[80vh] flex overflow-hidden">
        
        <!-- Left Side: Image Upload & Preview -->
        <div class="w-1/2 p-6 border-r flex flex-col items-center justify-center">
            <label for="imageUpload" class="cursor-pointer border-2 border-dashed border-gray-400 p-6 rounded-lg text-gray-500 text-center w-full h-full flex flex-col items-center justify-center">
                <span class="text-lg">Drag & drop or click to upload an image</span>
                <input type="file" id="imageUpload" class="hidden" accept="image/png, image/jpeg">
            </label>
            <div id="imagePreview" class="mt-4 hidden w-full flex justify-center">
                <img id="previewImg" class="max-h-60 rounded-lg shadow-md" alt="Uploaded Image">
            </div>
        </div>

        <!-- Right Side: Prompt/Metadata Display -->
        <div class="w-1/2 p-6 flex flex-col">
            <h2 class="text-xl font-semibold mb-2">Metadata & Prompt</h2>
            <div id="metadataContainer" class="bg-gray-50 p-4 border rounded-lg overflow-auto h-full">
                <pre id="metadataOutput" class="text-sm text-gray-700 whitespace-pre-wrap"></pre>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const dropArea = document.querySelector("label[for='imageUpload']");
            const fileInput = document.getElementById("imageUpload");
            const preview = document.getElementById("previewImg");
            const previewContainer = document.getElementById("imagePreview");
            const metadataOutput = document.getElementById("metadataOutput");
        
            // Prevent default drag behaviors
            ["dragenter", "dragover", "dragleave", "drop"].forEach(eventName => {
                dropArea.addEventListener(eventName, (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                }, false);
            });
        
            // Highlight drop area on drag
            ["dragenter", "dragover"].forEach(eventName => {
                dropArea.addEventListener(eventName, () => {
                    dropArea.classList.add("border-blue-500");
                }, false);
            });
        
            ["dragleave", "drop"].forEach(eventName => {
                dropArea.addEventListener(eventName, () => {
                    dropArea.classList.remove("border-blue-500");
                }, false);
            });
        
            // Handle file drop
            dropArea.addEventListener("drop", (e) => {
                const file = e.dataTransfer.files[0];
                if (file) {
                    handleFile(file);
                }
            });
        
            // Handle file selection
            fileInput.addEventListener("change", (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });
        
            async function handleFile(file) {
                // Show image preview
                const reader = new FileReader();
                reader.onload = () => {
                    preview.src = reader.result;
                    previewContainer.classList.remove("hidden");
                };
                reader.readAsDataURL(file);
        
                // Upload the image to backend
                const formData = new FormData();
                formData.append("image", file);
        
                const response = await fetch("/upload", {
                    method: "POST",
                    body: formData
                });
        
                const result = await response.json();
                metadataOutput.textContent = JSON.stringify(result.metadata, null, 2);
            }
        });
    </script>

</body>
</html>
